<template>
	<v-sheet
		width="400"
		color="transparent"
		class="py-4"
	>
		<div class="text-center text-subtitle-1">
			Preview
		</div>

		<div class="position-relative">
			<svg
				viewBox="0 0 432 740"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<g filter="url(#filter0_d_92_889)">
					<rect
						x="28.5"
						y="21.5"
						width="373"
						height="693"
						rx="36.5"
						stroke="white"
						stroke-width="7"
						shape-rendering="crispEdges"
					/>
					<path
						d="M32 58C32 39.7746 46.7746 25 65 25H365C383.225 25 398 39.7746 398 58V113H32V58Z"
						fill="#00A884"
					/>
					<g clip-path="url(#clip0_92_889)">
						<path
							d="M76 89C87.0457 89 96 80.0457 96 69C96 57.9543 87.0457 49 76 49C64.9543 49 56 57.9543 56 69C56 80.0457 64.9543 89 76 89Z"
							fill="#008069"
						/>
						<path
							d="M82.0704 64.963C82.5687 64.963 83.0139 65.2747 83.1842 65.7431L84.6926 69.8913C84.9163 70.5064 84.599 71.1864 83.9838 71.4101C83.854 71.4573 83.7169 71.4815 83.5788 71.4815H83.4931V75.9259C83.4931 76.4168 83.0951 76.8148 82.6042 76.8148C82.1133 76.8148 81.7153 76.4168 81.7153 75.9259V71.4815H78.1598V75.6296C78.1598 76.2842 77.6291 76.8148 76.9746 76.8148H70.4561C69.8015 76.8148 69.2709 76.2842 69.2709 75.6296V71.4815H69.1852C68.5306 71.4815 68 70.9509 68 70.2963C68 70.1582 68.0241 70.0211 68.0713 69.8913L69.5798 65.7431C69.7501 65.2747 70.1952 64.963 70.6936 64.963H82.0704ZM76.382 71.4815H71.0487V75.037H76.382V71.4815ZM82.0116 62C82.5025 62 82.9005 62.398 82.9005 62.8889C82.9005 63.3798 82.5025 63.7778 82.0116 63.7778H70.7524C70.2614 63.7778 69.8635 63.3798 69.8635 62.8889C69.8635 62.398 70.2614 62 70.7524 62H82.0116Z"
							fill="white"
						/>
					</g>
					<path
						d="M106 69H231"
						stroke="white"
						stroke-width="8"
						stroke-linecap="round"
					/>
					<path
						d="M32 113H398V678C398 696.225 383.225 711 365 711H65C46.7746 711 32 696.225 32 678V113Z"
						fill="#EAE6DF"
					/>

					<!-- <g clip-path="url(#clip1_92_889)">
						<path
							d="M61.29 131C60.0877 131 48.2843 131 45.8797 131C44.039 131 43.4481 132.162 44.5494 133.582L51.276 142.253"
							fill="white"
						/>
					</g> -->

					<line
						x1="49.9983"
						y1="345.558"
						x2="359.998"
						y2="344.5"
						stroke="#E2E8F0"
					/>

					<mask
						id="path-18-inside-1_92_889"
						fill="white"
					>
						<path d="M60 390.058H350V434.058H60V390.058Z" />
					</mask>
					<path
						d="M60 391.058H350V389.058H60V391.058Z"
						fill="#E2E8F0"
						mask="url(#path-18-inside-1_92_889)"
					/>

					<rect
						x="40"
						y="657"
						width="350"
						height="46"
						rx="23"
						fill="white"
					/>
					<path
						d="M19 154C19 150.686 21.6863 148 25 148V178C21.6863 178 19 175.314 19 172V154Z"
						fill="white"
					/>
					<path
						d="M19 192C19 188.686 21.6863 186 25 186V216C21.6863 216 19 213.314 19 210V192Z"
						fill="white"
					/>
					<path
						d="M405 138C408.314 138 411 140.686 411 144V192C411 195.314 408.314 198 405 198V138Z"
						fill="white"
					/>
				</g>
				<defs>
					<filter
						id="filter0_d_92_889"
						x="0"
						y="0"
						width="432"
						height="740"
						filterUnits="userSpaceOnUse"
						color-interpolation-filters="sRGB"
					>
						<feFlood
							flood-opacity="0"
							result="BackgroundImageFix"
						/>
						<feColorMatrix
							in="SourceAlpha"
							type="matrix"
							values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
							result="hardAlpha"
						/>
						<feOffset
							dx="1"
							dy="2"
						/>
						<feGaussianBlur stdDeviation="10" />
						<feComposite
							in2="hardAlpha"
							operator="out"
						/>
						<feColorMatrix
							type="matrix"
							values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"
						/>
						<feBlend
							mode="normal"
							in2="BackgroundImageFix"
							result="effect1_dropShadow_92_889"
						/>
						<feBlend
							mode="normal"
							in="SourceGraphic"
							in2="effect1_dropShadow_92_889"
							result="shape"
						/>
					</filter>
					<clipPath id="clip0_92_889">
						<rect
							width="40"
							height="40"
							fill="white"
							transform="translate(56 49)"
						/>
					</clipPath>
					<clipPath id="clip1_92_889">
						<rect
							width="6"
							height="11"
							fill="white"
							transform="matrix(-1 0 0 1 50 131)"
						/>
					</clipPath>

				</defs>
			</svg>
			<v-sheet
				class="message-box"
				:dir="template.language === 'ar_SA'? 'rtl': 'ltr'"
			>
				<div
					v-if="header?.format === 'TEXT'"
					class="header text"
				>
					{{ header?.value.text }}
				</div>
				<div
					v-else-if="header?.format === 'IMAGE'"
					class="header image"
					:class="{ 'no-url': !header?.value.url }"
				>
					<v-img
						:src="header.value.url"
						:aspect-ratio="290/200"
						cover
						rounded="lg"
					/>
				</div>

				<div
					v-if="body"
					class="body"
					v-text="body?.text"
				/>

				<div
					v-if="footer"
					class="footer"
				>
					<div v-text="footer?.text" />
					<div>
						12:45 PM
					</div>
				</div>

				<div
					v-if="buttons && buttons.buttons.length"
					class="buttons"
				>
					<div
						v-for="btn, b in buttons.buttons"
						:key="`button-${b}`"
						class="button"
					>
						<div
							v-if="btn.type === 'CALL'"
							class="call"
						>
							<a :href="`tel:${btn.value.phone_number}`">
								<v-icon
									start
									size="12"
									icon="mdi-phone"
								/>
								{{ btn.text }}</a>
						</div>
						<div
							v-else-if="btn.type === 'URL'"
							class="url"
						>
							<a
								:href="btn.value.url"
								target="_blank"
							>
								<v-icon
									start
									size="12"
									icon="mdi-open-in-new"
								/>
								{{ btn.text }}</a>
						</div>
					</div>
				</div>
			</v-sheet>
		</div>
	</v-sheet>
</template>

<script lang="ts" setup>
import type { Template } from '~/types/TemplatesBody'

type Props = {
	template: Template
}

const p = defineProps<Props>()

const header = computed(() => p.template.components.find(component => component.type === 'HEADER'))

const body = computed(() => p.template.components.find(component => component.type === 'BODY'))

const footer = computed(() => p.template.components.find(component => component.type === 'FOOTER'))

const buttons = computed(() => p.template.components.find(component => component.type === 'BUTTONS'))
</script>

<style scoped lang="scss">
.message-box {
	&:after{
		content: "";
		position: absolute;
		top:0;
		left: -6px;
		background-image: url("/images/arrow.png");
		background-size: contain;
		width:6px;
		height: 11px;
	}
	position: absolute;
	left: 47px;
	right: 47px;
	top: 121px;
	padding: 10px;
	border-radius: 0 12px 12px 12px;
	font-family: "Plus Jakarta Sans";
	display: flex;
	flex-direction: column;
	gap:10px;
	user-select: none;
	.header {
		&.text{
			font-weight: 700;
			font-size: 16px;
			line-height: 24px;
		}
		&.image{
			width: 100%;
			height: 100%;
			&.no-url{
				background-color: #E2E8F0;
			}
		}

	}

	.body{
		font-weight: 500;
		font-size: 14px;
		line-height: 21px;
		white-space: pre-wrap;
	}

	.footer{
		font-weight: 400;
		font-size: 12px;
		line-height: 18px;
		color: #666666;
		display: flex;
		justify-content: space-between;
	}

	.buttons {
		.button {
			height: 44px;

			.call, .url{
				flex-grow:1;
				width: 100%;
				height:100%;
				display: flex;
				align-items: center;
				border-top: 1px solid #e2e8f0;
				color: #00A5F4;
				justify-content: center;
				a {
					color: inherit;
					width: 100%;
					text-align: center;
					font-size: 14px;
					font-weight: 400;
					line-height: 21px;
					margin: auto 0;
					text-decoration: none;
				}
			}
		}
	}
}
</style>
